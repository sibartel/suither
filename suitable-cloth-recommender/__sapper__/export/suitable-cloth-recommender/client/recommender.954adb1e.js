import{S as e,i as t,s,a2 as a,k as r,l as n,n as i,a3 as o,y as l,p as c,C as u,f as d,h as p,j as h,v as f,w as m,x as g,o as w,A as v,O as y,r as _,P as b,t as k,b as E,a4 as S}from"./client.043f108f.js";function x(e,t){if(/^(#|rgb|hsl|currentColor)/.test(t))return e.style.color=t,!1;if(t.startsWith("--"))return e.style.color=`var(${t})`,!1;const s=function(e){return e.split(" ").map((e=>/^(lighten|darken|accent)-/.test(e)?`text-${e}`:`${e}-text`))}(t);return e.classList.add(...s),s}var T=(e,t)=>{let s;return"string"==typeof t&&(s=x(e,t)),{update(t){s?e.classList.remove(...s):e.style.color=null,"string"==typeof t&&(s=x(e,t))}}};function z(e){let t,s=[{class:"underlay"},e[9],{"stroke-dashoffset":"0"}],p={};for(let e=0;e<s.length;e+=1)p=d(p,s[e]);return{c(){t=a("circle"),this.h()},l(e){t=r(e,"circle",{class:!0,"stroke-dashoffset":!0},1),n(t).forEach(i),this.h()},h(){o(t,p),l(t,"svelte-1hzfw0g",!0)},m(e,s){c(e,t,s)},p(e,a){o(t,p=u(s,[{class:"underlay"},e[9],{"stroke-dashoffset":"0"}])),l(t,"svelte-1hzfw0g",!0)},d(e){e&&i(t)}}}function j(e){let t,s,S,x,j,L,M,P,A,N,$,C=!e[1]&&z(e),O=[{class:"overlay"},e[9],{"stroke-dashoffset":e[8]}],R={};for(let e=0;e<O.length;e+=1)R=d(R,O[e]);const W=e[12].default,I=p(W,e,e[11],null);return{c(){t=h("div"),s=a("svg"),C&&C.c(),S=a("circle"),x=f(),j=h("div"),I&&I.c(),this.h()},l(e){t=r(e,"DIV",{role:!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,class:!0,style:!0});var a=n(t);s=r(a,"svg",{xmlns:!0,viewBox:!0,style:!0,class:!0},1);var o=n(s);C&&C.l(o),S=r(o,"circle",{class:!0,"stroke-dashoffset":!0},1),n(S).forEach(i),o.forEach(i),x=m(a),j=r(a,"DIV",{class:!0});var l=n(j);I&&I.l(l),l.forEach(i),a.forEach(i),this.h()},h(){o(S,R),l(S,"svelte-1hzfw0g",!0),g(s,"xmlns","http://www.w3.org/2000/svg"),g(s,"viewBox",e[7]+"\n    "+e[7]+"\n    "+2*e[7]+"\n    "+2*e[7]),w(s,"transform","rotate("+e[3]+"deg)"),g(s,"class","svelte-1hzfw0g"),g(j,"class","s-progress-circular__content svelte-1hzfw0g"),g(t,"role","progressbar"),g(t,"aria-valuemin","0"),g(t,"aria-valuemax","100"),g(t,"aria-valuenow",e[5]),g(t,"class",L="s-progress-circular "+e[0]+" svelte-1hzfw0g"),g(t,"style",M="width:"+e[4]+"px;height:"+e[4]+"px;"+e[6]),l(t,"indeterminate",e[1])},m(a,r){c(a,t,r),v(t,s),C&&C.m(s,null),v(s,S),v(t,x),v(t,j),I&&I.m(j,null),A=!0,N||($=y(P=T.call(null,t,e[2])),N=!0)},p(e,[a]){e[1]?C&&(C.d(1),C=null):C?C.p(e,a):(C=z(e),C.c(),C.m(s,S)),o(S,R=u(O,[{class:"overlay"},e[9],{"stroke-dashoffset":e[8]}])),l(S,"svelte-1hzfw0g",!0),(!A||8&a)&&w(s,"transform","rotate("+e[3]+"deg)"),I&&I.p&&(!A||2048&a)&&_(I,W,e,e[11],a,null,null),(!A||32&a)&&g(t,"aria-valuenow",e[5]),(!A||1&a&&L!==(L="s-progress-circular "+e[0]+" svelte-1hzfw0g"))&&g(t,"class",L),(!A||80&a&&M!==(M="width:"+e[4]+"px;height:"+e[4]+"px;"+e[6]))&&g(t,"style",M),P&&b(P.update)&&4&a&&P.update.call(null,e[2]),3&a&&l(t,"indeterminate",e[1])},i(e){A||(k(I,e),A=!0)},o(e){E(I,e),A=!1},d(e){e&&i(t),C&&C.d(),I&&I.d(e),N=!1,$()}}}function L(e,t,s){let{$$slots:a={},$$scope:r}=t,{class:n=""}=t,{indeterminate:i=!1}=t,{color:o="secondary"}=t,{rotate:l=0}=t,{size:c=32}=t,{value:u=0}=t,{width:d=4}=t,{style:p=""}=t;const h=125.664,f=20/(1-Number(d)/+c),m=Number(d)/+c*f*2,g=(100-u)/100*h,w={fill:"transparent",cx:2*f,cy:2*f,r:20,"stroke-width":m,"stroke-dasharray":h};return e.$$set=e=>{"class"in e&&s(0,n=e.class),"indeterminate"in e&&s(1,i=e.indeterminate),"color"in e&&s(2,o=e.color),"rotate"in e&&s(3,l=e.rotate),"size"in e&&s(4,c=e.size),"value"in e&&s(5,u=e.value),"width"in e&&s(10,d=e.width),"style"in e&&s(6,p=e.style),"$$scope"in e&&s(11,r=e.$$scope)},[n,i,o,l,c,u,p,f,g,w,d,r,a]}class M extends e{constructor(e){super(),t(this,e,L,j,s,{class:0,indeterminate:1,color:2,rotate:3,size:4,value:5,width:10,style:6})}}const P=Symbol("Comlink.proxy"),A=Symbol("Comlink.endpoint"),N=Symbol("Comlink.releaseProxy"),$=Symbol("Comlink.thrown"),C=e=>"object"==typeof e&&null!==e||"function"==typeof e,O=new Map([["proxy",{canHandle:e=>C(e)&&e[P],serialize(e){const{port1:t,port2:s}=new MessageChannel;return R(e,t),[s,[s]]},deserialize:e=>(e.start(),I(e))}],["throw",{canHandle:e=>C(e)&&$ in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function R(e,t=self){t.addEventListener("message",(function s(a){if(!a||!a.data)return;const{id:r,type:n,path:i}=Object.assign({path:[]},a.data),o=(a.data.argumentList||[]).map(V);let l;try{const t=i.slice(0,-1).reduce(((e,t)=>e[t]),e),s=i.reduce(((e,t)=>e[t]),e);switch(n){case"GET":l=s;break;case"SET":t[i.slice(-1)[0]]=V(a.data.value),l=!0;break;case"APPLY":l=s.apply(t,o);break;case"CONSTRUCT":l=function(e){return Object.assign(e,{[P]:!0})}(new s(...o));break;case"ENDPOINT":{const{port1:t,port2:s}=new MessageChannel;R(e,s),l=function(e,t){return U.set(e,t),e}(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[$]:0}}Promise.resolve(l).catch((e=>({value:e,[$]:0}))).then((e=>{const[a,i]=B(e);t.postMessage(Object.assign(Object.assign({},a),{id:r}),i),"RELEASE"===n&&(t.removeEventListener("message",s),W(t))}))})),t.start&&t.start()}function W(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function I(e,t){return H(e,[],t)}function D(e){if(e)throw new Error("Proxy has been released and is not useable")}function H(e,t=[],s=function(){}){let a=!1;const r=new Proxy(s,{get(s,n){if(D(a),n===N)return()=>Y(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{W(e),a=!0}));if("then"===n){if(0===t.length)return{then:()=>r};const s=Y(e,{type:"GET",path:t.map((e=>e.toString()))}).then(V);return s.then.bind(s)}return H(e,[...t,n])},set(s,r,n){D(a);const[i,o]=B(n);return Y(e,{type:"SET",path:[...t,r].map((e=>e.toString())),value:i},o).then(V)},apply(s,r,n){D(a);const i=t[t.length-1];if(i===A)return Y(e,{type:"ENDPOINT"}).then(V);if("bind"===i)return H(e,t.slice(0,-1));const[o,l]=G(n);return Y(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:o},l).then(V)},construct(s,r){D(a);const[n,i]=G(r);return Y(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:n},i).then(V)}});return r}function G(e){const t=e.map(B);return[t.map((e=>e[0])),(s=t.map((e=>e[1])),Array.prototype.concat.apply([],s))];var s}const U=new WeakMap;function B(e){for(const[t,s]of O)if(s.canHandle(e)){const[a,r]=s.serialize(e);return[{type:"HANDLER",name:t,value:a},r]}return[{type:"RAW",value:e},U.get(e)||[]]}function V(e){switch(e.type){case"HANDLER":return O.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Y(e,t,s){return new Promise((a=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(s){s.data&&s.data.id&&s.data.id===r&&(e.removeEventListener("message",t),a(s.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:r},t),s)}))}let F=[{description:"Walking shorts, short-sleeved shirt",category:["sport","casual"],insulation:.36,file_identifier:"shortshort"},{description:"Walking shorts, short-sleeved shirt plus long-sleeve sweater",category:["sport","casual"],insulation:.36,file_identifier:"shortsweater",variants:[{description:"sweater on",insulation:.61}]},{description:"Walking shorts, long-sleeved shirt",category:["sport","casual"],insulation:.4,file_identifier:"shortlong"},{description:"Trousers, short-sleeved shirt",category:["sport","casual"],insulation:.57,file_identifier:"longshort"},{description:"Trousers, short-sleeved shirt plus sweater",category:["sport","casual"],insulation:.57,file_identifier:"longsweater",variants:[{description:"sweater on",insulation:.82}]},{description:"Trousers, short-sleeved shirt plus jacket",category:["sport","casual"],insulation:.57,file_identifier:"longjacket",variants:[{description:"jacket on",insulation:.92,waterproof:!0}]},{description:"Trousers, long-sleeved shirt",category:["sport","casual"],insulation:.61,file_identifier:"trouserslong"},{description:"Trousers, long-sleeved shirt plus sweater",category:["sport","casual"],insulation:.61,file_identifier:"longlongsweater",variants:[{description:"sweater on",insulation:.86}]},{description:"Trousers, long-sleeved shirt plus jacket",category:["sport","casual"],insulation:.61,file_identifier:"trouserslongjacket",variants:[{description:"jacket on",insulation:.96,waterproof:!0}]},{description:"Trousers, long-sleeved shirt, long-sleeved sweater, T-shirt",category:["casual"],insulation:1.01,file_identifier:"trouserslonglong"}];let J=null;class X{constructor(e){this.cloth_sets=e,this.user_model=null}static get_categories(){return[...new Set(F.map((e=>e.category)).flat())]}static async get(){if(!J){if("undefined"==typeof Worker)throw new Error("Web worker not supported in current renderer.");let e=new X(F);await e.init(),J=e}return J}async init(){const e=I(new Worker(new URL("worker.3a52ba25.js",import.meta.url)));let t={};"undefined"!=typeof localStorage&&localStorage.getItem("user_model")&&(t=JSON.parse(localStorage.getItem("user_model"))),this.user_model=await new e(t)}async model_status(){return await this.user_model.status()}async reset_model(e){await this.user_model.reset(e),await this.save_model()}async save_model(){"undefined"!=typeof localStorage&&localStorage.setItem("user_model",await this.user_model.stringify())}async recommend(e=8,t=60,s=null,a=!1){let r=(await S.get_weather_forecast()).slice(0,e);return(await Promise.all(this.cloth_sets.filter((e=>!s||e.category.includes(s))).map((async s=>{let{variants:n,...i}=s;i.description="base";let o=[i,...n??[]],l=await Promise.all(r.map((async e=>(await Promise.all(o.map((async s=>({predicted_thermal_sensation:await this.user_model.predict(e.feels_like,s.insulation,t),precipitation_suitable:e.pop<.3||s.waterproof,...s}))))).reduce(((e,t)=>{if(!a){if(t.precipitation_suitable&&!e.precipitation_suitable)return t;if(e.precipitation_suitable&&!t.precipitation_suitable)return e}return Math.abs(e.predicted_thermal_sensation)<Math.abs(t.predicted_thermal_sensation)?e:t})))));return{predicted_thermal_sensation:{hourly:l,max:Math.max(...l.map((e=>e.predicted_thermal_sensation))),min:Math.min(...l.map((e=>e.predicted_thermal_sensation))),mean:l.map((e=>e.predicted_thermal_sensation)).reduce(((e,t)=>e+t),0)/e,mse:l.map((e=>e.predicted_thermal_sensation)).reduce(((e,t)=>e+Math.pow(t,2)),0)/e},precipitation_suitable:l.every((e=>e.precipitation_suitable)),...s}})))).filter((e=>a||e.precipitation_suitable)).sort(((e,t)=>Math.abs(e.predicted_thermal_sensation.mse)>Math.abs(t.predicted_thermal_sensation.mse)?1:-1))}async feedback(e,t,s,a){await this.user_model.feedback(e,t,s,a),await this.save_model()}async live_feedback(e,t,s){let a=await S.get_weather_current().feels_like;await this.user_model.feedback(a,e,t,s),await this.save_model()}}export{M as P,X as R,T};
