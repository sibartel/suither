import{S as e,i as t,s,j as a,k as r,z as i,A as n,p as o,O as l,n as c,ad as u,ae as d,l as p,af as h,E as f,f as m,h as g,x as v,y,o as w,C as _,Q as b,r as k,v as E,w as S,R as x,t as z,b as T,ag as j}from"./client.99afc144.js";function L(e,t){if(/^(#|rgb|hsl|currentColor)/.test(t))return e.style.color=t,!1;if(t.startsWith("--"))return e.style.color=`var(${t})`,!1;const s=function(e){return e.split(" ").map((e=>/^(lighten|darken|accent)-/.test(e)?`text-${e}`:`${e}-text`))}(t);return e.classList.add(...s),s}var M=(e,t)=>{let s;return"string"==typeof t&&(s=L(e,t)),{update(t){s?e.classList.remove(...s):e.style.color=null,"string"==typeof t&&(s=L(e,t))}}};function P(e){let t,s,u;return{c(){t=a("hr"),this.h()},l(e){t=r(e,"HR",{class:!0,role:!0,"aria-orientation":!0,style:!0}),this.h()},h(){i(t,"class",s="s-divider "+e[0]+" svelte-syn7p7"),i(t,"role","separator"),i(t,"aria-orientation",u=e[2]?"vertical":"horizontal"),i(t,"style",e[3]),n(t,"inset",e[1]),n(t,"vertical",e[2])},m(e,s){o(e,t,s)},p(e,[a]){1&a&&s!==(s="s-divider "+e[0]+" svelte-syn7p7")&&i(t,"class",s),4&a&&u!==(u=e[2]?"vertical":"horizontal")&&i(t,"aria-orientation",u),8&a&&i(t,"style",e[3]),3&a&&n(t,"inset",e[1]),5&a&&n(t,"vertical",e[2])},i:l,o:l,d(e){e&&c(t)}}}function $(e,t,s){let{class:a=""}=t,{inset:r=!1}=t,{vertical:i=!1}=t,{style:n=null}=t;return e.$$set=e=>{"class"in e&&s(0,a=e.class),"inset"in e&&s(1,r=e.inset),"vertical"in e&&s(2,i=e.vertical),"style"in e&&s(3,n=e.style)},[a,r,i,n]}class A extends e{constructor(e){super(),t(this,e,$,P,s,{class:0,inset:1,vertical:2,style:3})}}function R(e){let t,s=[{class:"underlay"},e[9],{"stroke-dashoffset":"0"}],a={};for(let e=0;e<s.length;e+=1)a=m(a,s[e]);return{c(){t=u("circle"),this.h()},l(e){t=d(e,"circle",{class:!0,"stroke-dashoffset":!0}),p(t).forEach(c),this.h()},h(){h(t,a),n(t,"svelte-1hzfw0g",!0)},m(e,s){o(e,t,s)},p(e,r){h(t,a=f(s,[{class:"underlay"},e[9],{"stroke-dashoffset":"0"}])),n(t,"svelte-1hzfw0g",!0)},d(e){e&&c(t)}}}function N(e){let t,s,l,j,L,P,$,A,N,C,O,W=!e[1]&&R(e),I=[{class:"overlay"},e[9],{"stroke-dashoffset":e[8]}],D={};for(let e=0;e<I.length;e+=1)D=m(D,I[e]);const H=e[12].default,G=g(H,e,e[11],null);return{c(){t=a("div"),s=u("svg"),W&&W.c(),l=u("circle"),j=v(),L=a("div"),G&&G.c(),this.h()},l(e){t=r(e,"DIV",{role:!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,class:!0,style:!0});var a=p(t);s=d(a,"svg",{xmlns:!0,viewBox:!0,style:!0,class:!0});var i=p(s);W&&W.l(i),l=d(i,"circle",{class:!0,"stroke-dashoffset":!0}),p(l).forEach(c),i.forEach(c),j=y(a),L=r(a,"DIV",{class:!0});var n=p(L);G&&G.l(n),n.forEach(c),a.forEach(c),this.h()},h(){h(l,D),n(l,"svelte-1hzfw0g",!0),i(s,"xmlns","http://www.w3.org/2000/svg"),i(s,"viewBox",e[7]+"\n    "+e[7]+"\n    "+2*e[7]+"\n    "+2*e[7]),w(s,"transform","rotate("+e[3]+"deg)"),i(s,"class","svelte-1hzfw0g"),i(L,"class","s-progress-circular__content svelte-1hzfw0g"),i(t,"role","progressbar"),i(t,"aria-valuemin","0"),i(t,"aria-valuemax","100"),i(t,"aria-valuenow",e[5]),i(t,"class",P="s-progress-circular "+e[0]+" svelte-1hzfw0g"),i(t,"style",$="width:"+e[4]+"px;height:"+e[4]+"px;"+e[6]),n(t,"indeterminate",e[1])},m(a,r){o(a,t,r),_(t,s),W&&W.m(s,null),_(s,l),_(t,j),_(t,L),G&&G.m(L,null),N=!0,C||(O=b(A=M.call(null,t,e[2])),C=!0)},p(e,[a]){e[1]?W&&(W.d(1),W=null):W?W.p(e,a):(W=R(e),W.c(),W.m(s,l)),h(l,D=f(I,[{class:"overlay"},e[9],{"stroke-dashoffset":e[8]}])),n(l,"svelte-1hzfw0g",!0),(!N||8&a)&&w(s,"transform","rotate("+e[3]+"deg)"),G&&G.p&&(!N||2048&a)&&k(G,H,e,e[11],N?S(H,e[11],a,null):E(e[11]),null),(!N||32&a)&&i(t,"aria-valuenow",e[5]),(!N||1&a&&P!==(P="s-progress-circular "+e[0]+" svelte-1hzfw0g"))&&i(t,"class",P),(!N||80&a&&$!==($="width:"+e[4]+"px;height:"+e[4]+"px;"+e[6]))&&i(t,"style",$),A&&x(A.update)&&4&a&&A.update.call(null,e[2]),3&a&&n(t,"indeterminate",e[1])},i(e){N||(z(G,e),N=!0)},o(e){T(G,e),N=!1},d(e){e&&c(t),W&&W.d(),G&&G.d(e),C=!1,O()}}}function C(e,t,s){let{$$slots:a={},$$scope:r}=t,{class:i=""}=t,{indeterminate:n=!1}=t,{color:o="secondary"}=t,{rotate:l=0}=t,{size:c=32}=t,{value:u=0}=t,{width:d=4}=t,{style:p=""}=t;const h=125.664,f=20/(1-Number(d)/+c),m=Number(d)/+c*f*2,g=(100-u)/100*h,v={fill:"transparent",cx:2*f,cy:2*f,r:20,"stroke-width":m,"stroke-dasharray":h};return e.$$set=e=>{"class"in e&&s(0,i=e.class),"indeterminate"in e&&s(1,n=e.indeterminate),"color"in e&&s(2,o=e.color),"rotate"in e&&s(3,l=e.rotate),"size"in e&&s(4,c=e.size),"value"in e&&s(5,u=e.value),"width"in e&&s(10,d=e.width),"style"in e&&s(6,p=e.style),"$$scope"in e&&s(11,r=e.$$scope)},[i,n,o,l,c,u,p,f,g,v,d,r,a]}class O extends e{constructor(e){super(),t(this,e,C,N,s,{class:0,indeterminate:1,color:2,rotate:3,size:4,value:5,width:10,style:6})}}const W=Symbol("Comlink.proxy"),I=Symbol("Comlink.endpoint"),D=Symbol("Comlink.releaseProxy"),H=Symbol("Comlink.thrown"),G=e=>"object"==typeof e&&null!==e||"function"==typeof e,U=new Map([["proxy",{canHandle:e=>G(e)&&e[W],serialize(e){const{port1:t,port2:s}=new MessageChannel;return B(e,t),[s,[s]]},deserialize:e=>(e.start(),Y(e))}],["throw",{canHandle:e=>G(e)&&H in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function B(e,t=self){t.addEventListener("message",(function s(a){if(!a||!a.data)return;const{id:r,type:i,path:n}=Object.assign({path:[]},a.data),o=(a.data.argumentList||[]).map(K);let l;try{const t=n.slice(0,-1).reduce(((e,t)=>e[t]),e),s=n.reduce(((e,t)=>e[t]),e);switch(i){case"GET":l=s;break;case"SET":t[n.slice(-1)[0]]=K(a.data.value),l=!0;break;case"APPLY":l=s.apply(t,o);break;case"CONSTRUCT":l=function(e){return Object.assign(e,{[W]:!0})}(new s(...o));break;case"ENDPOINT":{const{port1:t,port2:s}=new MessageChannel;B(e,s),l=function(e,t){return X.set(e,t),e}(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[H]:0}}Promise.resolve(l).catch((e=>({value:e,[H]:0}))).then((e=>{const[a,n]=q(e);t.postMessage(Object.assign(Object.assign({},a),{id:r}),n),"RELEASE"===i&&(t.removeEventListener("message",s),V(t))}))})),t.start&&t.start()}function V(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function Y(e,t){return J(e,[],t)}function F(e){if(e)throw new Error("Proxy has been released and is not useable")}function J(e,t=[],s=function(){}){let a=!1;const r=new Proxy(s,{get(s,i){if(F(a),i===D)return()=>Z(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{V(e),a=!0}));if("then"===i){if(0===t.length)return{then:()=>r};const s=Z(e,{type:"GET",path:t.map((e=>e.toString()))}).then(K);return s.then.bind(s)}return J(e,[...t,i])},set(s,r,i){F(a);const[n,o]=q(i);return Z(e,{type:"SET",path:[...t,r].map((e=>e.toString())),value:n},o).then(K)},apply(s,r,i){F(a);const n=t[t.length-1];if(n===I)return Z(e,{type:"ENDPOINT"}).then(K);if("bind"===n)return J(e,t.slice(0,-1));const[o,l]=Q(i);return Z(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:o},l).then(K)},construct(s,r){F(a);const[i,n]=Q(r);return Z(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:i},n).then(K)}});return r}function Q(e){const t=e.map(q);return[t.map((e=>e[0])),(s=t.map((e=>e[1])),Array.prototype.concat.apply([],s))];var s}const X=new WeakMap;function q(e){for(const[t,s]of U)if(s.canHandle(e)){const[a,r]=s.serialize(e);return[{type:"HANDLER",name:t,value:a},r]}return[{type:"RAW",value:e},X.get(e)||[]]}function K(e){switch(e.type){case"HANDLER":return U.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Z(e,t,s){return new Promise((a=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(s){s.data&&s.data.id&&s.data.id===r&&(e.removeEventListener("message",t),a(s.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:r},t),s)}))}let ee=[{description:"Walking shorts, short-sleeved shirt",category:["sport","casual"],insulation:.36,file_identifier:"shortshort"},{description:"Walking shorts, short-sleeved shirt plus long-sleeve sweater",category:["sport","casual"],insulation:.36,file_identifier:"shortsweater",variants:[{description:"sweater on",insulation:.61}]},{description:"Walking shorts, long-sleeved shirt",category:["sport","casual"],insulation:.4,file_identifier:"shortlong"},{description:"Trousers, short-sleeved shirt",category:["sport","casual"],insulation:.57,file_identifier:"longshort"},{description:"Trousers, short-sleeved shirt plus sweater",category:["sport","casual"],insulation:.57,file_identifier:"longsweater",variants:[{description:"sweater on",insulation:.82}]},{description:"Trousers, short-sleeved shirt plus jacket",category:["sport","casual"],insulation:.57,file_identifier:"longjacket",variants:[{description:"jacket on",insulation:.92,waterproof:!0}]},{description:"Trousers, long-sleeved shirt",category:["sport","casual"],insulation:.61,file_identifier:"trouserslong"},{description:"Trousers, long-sleeved shirt plus sweater",category:["sport","casual"],insulation:.61,file_identifier:"longlongsweater",variants:[{description:"sweater on",insulation:.86}]},{description:"Trousers, long-sleeved shirt plus jacket",category:["sport","casual"],insulation:.61,file_identifier:"trouserslongjacket",variants:[{description:"jacket on",insulation:.96,waterproof:!0}]},{description:"Trousers, long-sleeved shirt, long-sleeved sweater, T-shirt",category:["casual"],insulation:1.01,file_identifier:"trouserslonglong"}];let te=null;class se{constructor(e){this.cloth_sets=e,this.user_model=null}static get_categories(){return[...new Set(ee.map((e=>e.category)).flat())]}static async get(){if(!te){if("undefined"==typeof Worker)throw new Error("Web worker not supported in current renderer.");let e=new se(ee);await e.init(),te=e}return te}async init(){const e=Y(new Worker(new URL("worker.0b932b14.js",import.meta.url)));let t={};"undefined"!=typeof localStorage&&localStorage.getItem("user_model")&&(t=JSON.parse(localStorage.getItem("user_model"))),this.user_model=await new e(t)}async model_status(){return await this.user_model.status()}async reset_model(e){await this.user_model.reset(e),await this.save_model()}async save_model(){"undefined"!=typeof localStorage&&localStorage.setItem("user_model",await this.user_model.stringify())}async recommend(e=8,t=60,s=null,a=!1){let r=(await j.get_weather_forecast()).slice(0,e);return(await Promise.all(this.cloth_sets.filter((e=>!s||e.category.includes(s))).map((async s=>{let{variants:i,...n}=s;n.description="base";let o=[n,...i??[]],l=await Promise.all(r.map((async e=>(await Promise.all(o.map((async s=>({predicted_thermal_sensation:await this.user_model.predict(e.feels_like,s.insulation,t),precipitation_suitable:e.pop<.3||s.waterproof,...s,...e}))))).reduce(((e,t)=>{if(!a){if(t.precipitation_suitable&&!e.precipitation_suitable)return t;if(e.precipitation_suitable&&!t.precipitation_suitable)return e}return Math.abs(e.predicted_thermal_sensation)<Math.abs(t.predicted_thermal_sensation)?e:t})))));return{predicted_thermal_sensation:{hourly:l,max:Math.max(...l.map((e=>e.predicted_thermal_sensation))),min:Math.min(...l.map((e=>e.predicted_thermal_sensation))),mean:l.map((e=>e.predicted_thermal_sensation)).reduce(((e,t)=>e+t),0)/e,mse:l.map((e=>e.predicted_thermal_sensation)).reduce(((e,t)=>e+Math.pow(t,2)),0)/e},precipitation_suitable:l.every((e=>e.precipitation_suitable)),...s}})))).filter((e=>a||e.precipitation_suitable)).sort(((e,t)=>Math.abs(e.predicted_thermal_sensation.mse)>Math.abs(t.predicted_thermal_sensation.mse)?1:-1))}async feedback(e,t,s,a){await this.user_model.feedback(e,t,s,a),await this.save_model()}async live_feedback(e,t,s){let a=(await j.get_weather_current()).feels_like;await this.user_model.feedback(a,e,t,s),await this.save_model()}}export{A as D,O as P,se as R,M as T};
