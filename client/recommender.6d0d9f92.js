import{S as e,i as t,s,j as a,k as r,x as i,y as n,p as o,M as l,n as c,aa as u,l as d,ab as p,C as h,f,h as m,v as g,w as v,o as y,A as w,O as _,r as b,P as k,t as E,b as S,ac as x}from"./client.8ef222e8.js";function z(e,t){if(/^(#|rgb|hsl|currentColor)/.test(t))return e.style.color=t,!1;if(t.startsWith("--"))return e.style.color=`var(${t})`,!1;const s=function(e){return e.split(" ").map((e=>/^(lighten|darken|accent)-/.test(e)?`text-${e}`:`${e}-text`))}(t);return e.classList.add(...s),s}var T=(e,t)=>{let s;return"string"==typeof t&&(s=z(e,t)),{update(t){s?e.classList.remove(...s):e.style.color=null,"string"==typeof t&&(s=z(e,t))}}};function M(e){let t,s,u;return{c(){t=a("hr"),this.h()},l(e){t=r(e,"HR",{class:!0,role:!0,"aria-orientation":!0,style:!0}),this.h()},h(){i(t,"class",s="s-divider "+e[0]+" svelte-syn7p7"),i(t,"role","separator"),i(t,"aria-orientation",u=e[2]?"vertical":"horizontal"),i(t,"style",e[3]),n(t,"inset",e[1]),n(t,"vertical",e[2])},m(e,s){o(e,t,s)},p(e,[a]){1&a&&s!==(s="s-divider "+e[0]+" svelte-syn7p7")&&i(t,"class",s),4&a&&u!==(u=e[2]?"vertical":"horizontal")&&i(t,"aria-orientation",u),8&a&&i(t,"style",e[3]),3&a&&n(t,"inset",e[1]),5&a&&n(t,"vertical",e[2])},i:l,o:l,d(e){e&&c(t)}}}function j(e,t,s){let{class:a=""}=t,{inset:r=!1}=t,{vertical:i=!1}=t,{style:n=null}=t;return e.$$set=e=>{"class"in e&&s(0,a=e.class),"inset"in e&&s(1,r=e.inset),"vertical"in e&&s(2,i=e.vertical),"style"in e&&s(3,n=e.style)},[a,r,i,n]}class L extends e{constructor(e){super(),t(this,e,j,M,s,{class:0,inset:1,vertical:2,style:3})}}function P(e){let t,s=[{class:"underlay"},e[9],{"stroke-dashoffset":"0"}],a={};for(let e=0;e<s.length;e+=1)a=f(a,s[e]);return{c(){t=u("circle"),this.h()},l(e){t=r(e,"circle",{class:!0,"stroke-dashoffset":!0},1),d(t).forEach(c),this.h()},h(){p(t,a),n(t,"svelte-1hzfw0g",!0)},m(e,s){o(e,t,s)},p(e,r){p(t,a=h(s,[{class:"underlay"},e[9],{"stroke-dashoffset":"0"}])),n(t,"svelte-1hzfw0g",!0)},d(e){e&&c(t)}}}function $(e){let t,s,l,x,z,M,j,L,$,A,N,R=!e[1]&&P(e),C=[{class:"overlay"},e[9],{"stroke-dashoffset":e[8]}],O={};for(let e=0;e<C.length;e+=1)O=f(O,C[e]);const W=e[12].default,I=m(W,e,e[11],null);return{c(){t=a("div"),s=u("svg"),R&&R.c(),l=u("circle"),x=g(),z=a("div"),I&&I.c(),this.h()},l(e){t=r(e,"DIV",{role:!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,class:!0,style:!0});var a=d(t);s=r(a,"svg",{xmlns:!0,viewBox:!0,style:!0,class:!0},1);var i=d(s);R&&R.l(i),l=r(i,"circle",{class:!0,"stroke-dashoffset":!0},1),d(l).forEach(c),i.forEach(c),x=v(a),z=r(a,"DIV",{class:!0});var n=d(z);I&&I.l(n),n.forEach(c),a.forEach(c),this.h()},h(){p(l,O),n(l,"svelte-1hzfw0g",!0),i(s,"xmlns","http://www.w3.org/2000/svg"),i(s,"viewBox",e[7]+"\n    "+e[7]+"\n    "+2*e[7]+"\n    "+2*e[7]),y(s,"transform","rotate("+e[3]+"deg)"),i(s,"class","svelte-1hzfw0g"),i(z,"class","s-progress-circular__content svelte-1hzfw0g"),i(t,"role","progressbar"),i(t,"aria-valuemin","0"),i(t,"aria-valuemax","100"),i(t,"aria-valuenow",e[5]),i(t,"class",M="s-progress-circular "+e[0]+" svelte-1hzfw0g"),i(t,"style",j="width:"+e[4]+"px;height:"+e[4]+"px;"+e[6]),n(t,"indeterminate",e[1])},m(a,r){o(a,t,r),w(t,s),R&&R.m(s,null),w(s,l),w(t,x),w(t,z),I&&I.m(z,null),$=!0,A||(N=_(L=T.call(null,t,e[2])),A=!0)},p(e,[a]){e[1]?R&&(R.d(1),R=null):R?R.p(e,a):(R=P(e),R.c(),R.m(s,l)),p(l,O=h(C,[{class:"overlay"},e[9],{"stroke-dashoffset":e[8]}])),n(l,"svelte-1hzfw0g",!0),(!$||8&a)&&y(s,"transform","rotate("+e[3]+"deg)"),I&&I.p&&(!$||2048&a)&&b(I,W,e,e[11],a,null,null),(!$||32&a)&&i(t,"aria-valuenow",e[5]),(!$||1&a&&M!==(M="s-progress-circular "+e[0]+" svelte-1hzfw0g"))&&i(t,"class",M),(!$||80&a&&j!==(j="width:"+e[4]+"px;height:"+e[4]+"px;"+e[6]))&&i(t,"style",j),L&&k(L.update)&&4&a&&L.update.call(null,e[2]),3&a&&n(t,"indeterminate",e[1])},i(e){$||(E(I,e),$=!0)},o(e){S(I,e),$=!1},d(e){e&&c(t),R&&R.d(),I&&I.d(e),A=!1,N()}}}function A(e,t,s){let{$$slots:a={},$$scope:r}=t,{class:i=""}=t,{indeterminate:n=!1}=t,{color:o="secondary"}=t,{rotate:l=0}=t,{size:c=32}=t,{value:u=0}=t,{width:d=4}=t,{style:p=""}=t;const h=125.664,f=20/(1-Number(d)/+c),m=Number(d)/+c*f*2,g=(100-u)/100*h,v={fill:"transparent",cx:2*f,cy:2*f,r:20,"stroke-width":m,"stroke-dasharray":h};return e.$$set=e=>{"class"in e&&s(0,i=e.class),"indeterminate"in e&&s(1,n=e.indeterminate),"color"in e&&s(2,o=e.color),"rotate"in e&&s(3,l=e.rotate),"size"in e&&s(4,c=e.size),"value"in e&&s(5,u=e.value),"width"in e&&s(10,d=e.width),"style"in e&&s(6,p=e.style),"$$scope"in e&&s(11,r=e.$$scope)},[i,n,o,l,c,u,p,f,g,v,d,r,a]}class N extends e{constructor(e){super(),t(this,e,A,$,s,{class:0,indeterminate:1,color:2,rotate:3,size:4,value:5,width:10,style:6})}}const R=Symbol("Comlink.proxy"),C=Symbol("Comlink.endpoint"),O=Symbol("Comlink.releaseProxy"),W=Symbol("Comlink.thrown"),I=e=>"object"==typeof e&&null!==e||"function"==typeof e,D=new Map([["proxy",{canHandle:e=>I(e)&&e[R],serialize(e){const{port1:t,port2:s}=new MessageChannel;return H(e,t),[s,[s]]},deserialize:e=>(e.start(),U(e))}],["throw",{canHandle:e=>I(e)&&W in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function H(e,t=self){t.addEventListener("message",(function s(a){if(!a||!a.data)return;const{id:r,type:i,path:n}=Object.assign({path:[]},a.data),o=(a.data.argumentList||[]).map(X);let l;try{const t=n.slice(0,-1).reduce(((e,t)=>e[t]),e),s=n.reduce(((e,t)=>e[t]),e);switch(i){case"GET":l=s;break;case"SET":t[n.slice(-1)[0]]=X(a.data.value),l=!0;break;case"APPLY":l=s.apply(t,o);break;case"CONSTRUCT":l=function(e){return Object.assign(e,{[R]:!0})}(new s(...o));break;case"ENDPOINT":{const{port1:t,port2:s}=new MessageChannel;H(e,s),l=function(e,t){return F.set(e,t),e}(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(e){l={value:e,[W]:0}}Promise.resolve(l).catch((e=>({value:e,[W]:0}))).then((e=>{const[a,n]=J(e);t.postMessage(Object.assign(Object.assign({},a),{id:r}),n),"RELEASE"===i&&(t.removeEventListener("message",s),G(t))}))})),t.start&&t.start()}function G(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function U(e,t){return V(e,[],t)}function B(e){if(e)throw new Error("Proxy has been released and is not useable")}function V(e,t=[],s=function(){}){let a=!1;const r=new Proxy(s,{get(s,i){if(B(a),i===O)return()=>q(e,{type:"RELEASE",path:t.map((e=>e.toString()))}).then((()=>{G(e),a=!0}));if("then"===i){if(0===t.length)return{then:()=>r};const s=q(e,{type:"GET",path:t.map((e=>e.toString()))}).then(X);return s.then.bind(s)}return V(e,[...t,i])},set(s,r,i){B(a);const[n,o]=J(i);return q(e,{type:"SET",path:[...t,r].map((e=>e.toString())),value:n},o).then(X)},apply(s,r,i){B(a);const n=t[t.length-1];if(n===C)return q(e,{type:"ENDPOINT"}).then(X);if("bind"===n)return V(e,t.slice(0,-1));const[o,l]=Y(i);return q(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:o},l).then(X)},construct(s,r){B(a);const[i,n]=Y(r);return q(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:i},n).then(X)}});return r}function Y(e){const t=e.map(J);return[t.map((e=>e[0])),(s=t.map((e=>e[1])),Array.prototype.concat.apply([],s))];var s}const F=new WeakMap;function J(e){for(const[t,s]of D)if(s.canHandle(e)){const[a,r]=s.serialize(e);return[{type:"HANDLER",name:t,value:a},r]}return[{type:"RAW",value:e},F.get(e)||[]]}function X(e){switch(e.type){case"HANDLER":return D.get(e.name).deserialize(e.value);case"RAW":return e.value}}function q(e,t,s){return new Promise((a=>{const r=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(s){s.data&&s.data.id&&s.data.id===r&&(e.removeEventListener("message",t),a(s.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:r},t),s)}))}let K=[{description:"Walking shorts, short-sleeved shirt",category:["sport","casual"],insulation:.36,file_identifier:"shortshort"},{description:"Walking shorts, short-sleeved shirt plus long-sleeve sweater",category:["sport","casual"],insulation:.36,file_identifier:"shortsweater",variants:[{description:"sweater on",insulation:.61}]},{description:"Walking shorts, long-sleeved shirt",category:["sport","casual"],insulation:.4,file_identifier:"shortlong"},{description:"Trousers, short-sleeved shirt",category:["sport","casual"],insulation:.57,file_identifier:"longshort"},{description:"Trousers, short-sleeved shirt plus sweater",category:["sport","casual"],insulation:.57,file_identifier:"longsweater",variants:[{description:"sweater on",insulation:.82}]},{description:"Trousers, short-sleeved shirt plus jacket",category:["sport","casual"],insulation:.57,file_identifier:"longjacket",variants:[{description:"jacket on",insulation:.92,waterproof:!0}]},{description:"Trousers, long-sleeved shirt",category:["sport","casual"],insulation:.61,file_identifier:"trouserslong"},{description:"Trousers, long-sleeved shirt plus sweater",category:["sport","casual"],insulation:.61,file_identifier:"longlongsweater",variants:[{description:"sweater on",insulation:.86}]},{description:"Trousers, long-sleeved shirt plus jacket",category:["sport","casual"],insulation:.61,file_identifier:"trouserslongjacket",variants:[{description:"jacket on",insulation:.96,waterproof:!0}]},{description:"Trousers, long-sleeved shirt, long-sleeved sweater, T-shirt",category:["casual"],insulation:1.01,file_identifier:"trouserslonglong"}];let Q=null;class Z{constructor(e){this.cloth_sets=e,this.user_model=null}static get_categories(){return[...new Set(K.map((e=>e.category)).flat())]}static async get(){if(!Q){if("undefined"==typeof Worker)throw new Error("Web worker not supported in current renderer.");let e=new Z(K);await e.init(),Q=e}return Q}async init(){const e=U(new Worker(new URL("worker.6492aab9.js",import.meta.url)));let t={};"undefined"!=typeof localStorage&&localStorage.getItem("user_model")&&(t=JSON.parse(localStorage.getItem("user_model"))),this.user_model=await new e(t)}async model_status(){return await this.user_model.status()}async reset_model(e){await this.user_model.reset(e),await this.save_model()}async save_model(){"undefined"!=typeof localStorage&&localStorage.setItem("user_model",await this.user_model.stringify())}async recommend(e=8,t=60,s=null,a=!1){let r=(await x.get_weather_forecast()).slice(0,e);return(await Promise.all(this.cloth_sets.filter((e=>!s||e.category.includes(s))).map((async s=>{let{variants:i,...n}=s;n.description="base";let o=[n,...i??[]],l=await Promise.all(r.map((async e=>(await Promise.all(o.map((async s=>({predicted_thermal_sensation:await this.user_model.predict(e.feels_like,s.insulation,t),precipitation_suitable:e.pop<.3||s.waterproof,...s,...e}))))).reduce(((e,t)=>{if(!a){if(t.precipitation_suitable&&!e.precipitation_suitable)return t;if(e.precipitation_suitable&&!t.precipitation_suitable)return e}return Math.abs(e.predicted_thermal_sensation)<Math.abs(t.predicted_thermal_sensation)?e:t})))));return{predicted_thermal_sensation:{hourly:l,max:Math.max(...l.map((e=>e.predicted_thermal_sensation))),min:Math.min(...l.map((e=>e.predicted_thermal_sensation))),mean:l.map((e=>e.predicted_thermal_sensation)).reduce(((e,t)=>e+t),0)/e,mse:l.map((e=>e.predicted_thermal_sensation)).reduce(((e,t)=>e+Math.pow(t,2)),0)/e},precipitation_suitable:l.every((e=>e.precipitation_suitable)),...s}})))).filter((e=>a||e.precipitation_suitable)).sort(((e,t)=>Math.abs(e.predicted_thermal_sensation.mse)>Math.abs(t.predicted_thermal_sensation.mse)?1:-1))}async feedback(e,t,s,a){await this.user_model.feedback(e,t,s,a),await this.save_model()}async live_feedback(e,t,s){let a=(await x.get_weather_current()).feels_like;await this.user_model.feedback(a,e,t,s),await this.save_model()}}export{L as D,N as P,Z as R,T};
